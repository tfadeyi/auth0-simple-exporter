groups:
  - name: sloth-slo-sli-recordings-chatGPT-chatgpt-login
    rules:
      - record: slo:sli_error:ratio_rate5m
        expr: |
          (sum(rate(tenant_failed_login_operations_total{client="ChatGPT"}[5m])) OR on() vector(0))
          /
          (sum(rate(tenant_login_operations_total{client="ChatGPT"}[5m])))
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
          sloth_window: 5m
      - record: slo:sli_error:ratio_rate30m
        expr: |
          (sum(rate(tenant_failed_login_operations_total{client="ChatGPT"}[30m])) OR on() vector(0))
          /
          (sum(rate(tenant_login_operations_total{client="ChatGPT"}[30m])))
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
          sloth_window: 30m
      - record: slo:sli_error:ratio_rate1h
        expr: |
          (sum(rate(tenant_failed_login_operations_total{client="ChatGPT"}[1h])) OR on() vector(0))
          /
          (sum(rate(tenant_login_operations_total{client="ChatGPT"}[1h])))
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
          sloth_window: 1h
      - record: slo:sli_error:ratio_rate2h
        expr: |
          (sum(rate(tenant_failed_login_operations_total{client="ChatGPT"}[2h])) OR on() vector(0))
          /
          (sum(rate(tenant_login_operations_total{client="ChatGPT"}[2h])))
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
          sloth_window: 2h
      - record: slo:sli_error:ratio_rate6h
        expr: |
          (sum(rate(tenant_failed_login_operations_total{client="ChatGPT"}[6h])) OR on() vector(0))
          /
          (sum(rate(tenant_login_operations_total{client="ChatGPT"}[6h])))
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
          sloth_window: 6h
      - record: slo:sli_error:ratio_rate1d
        expr: |
          (sum(rate(tenant_failed_login_operations_total{client="ChatGPT"}[1d])) OR on() vector(0))
          /
          (sum(rate(tenant_login_operations_total{client="ChatGPT"}[1d])))
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
          sloth_window: 1d
      - record: slo:sli_error:ratio_rate3d
        expr: |
          (sum(rate(tenant_failed_login_operations_total{client="ChatGPT"}[3d])) OR on() vector(0))
          /
          (sum(rate(tenant_login_operations_total{client="ChatGPT"}[3d])))
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
          sloth_window: 3d
      - record: slo:sli_error:ratio_rate30d
        expr: |
          sum_over_time(slo:sli_error:ratio_rate5m{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"}[30d])
          / ignoring (sloth_window)
          count_over_time(slo:sli_error:ratio_rate5m{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"}[30d])
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
          sloth_window: 30d
  - name: sloth-slo-meta-recordings-chatGPT-chatgpt-login
    rules:
      - record: slo:objective:ratio
        expr: vector(0.95)
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
      - record: slo:error_budget:ratio
        expr: vector(1-0.95)
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
      - record: slo:time_period:days
        expr: vector(30)
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
      - record: slo:current_burn_rate:ratio
        expr: |
          slo:sli_error:ratio_rate5m{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"}
          / on(sloth_id, sloth_slo, sloth_service) group_left
          slo:error_budget:ratio{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"}
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
      - record: slo:period_burn_rate:ratio
        expr: |
          slo:sli_error:ratio_rate30d{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"}
          / on(sloth_id, sloth_slo, sloth_service) group_left
          slo:error_budget:ratio{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"}
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
      - record: slo:period_error_budget_remaining:ratio
        expr: 1 - slo:period_burn_rate:ratio{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT",
          sloth_slo="chatgpt-login"}
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
      - record: sloth_slo_info
        expr: vector(1)
        labels:
          project: openai-chatgpt
          sloth_id: chatGPT-chatgpt-login
          sloth_mode: cli-gen-prom
          sloth_objective: "95"
          sloth_service: chatGPT
          sloth_slo: chatgpt-login
          sloth_spec: prometheus/v1
          sloth_version: v0.11.0
  - name: sloth-slo-alerts-chatGPT-chatgpt-login
    rules:
      - alert: ChatGPTLogin
        expr: |
          (
              max(slo:sli_error:ratio_rate5m{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"} > (14.4 * 0.05)) without (sloth_window)
              and
              max(slo:sli_error:ratio_rate1h{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"} > (14.4 * 0.05)) without (sloth_window)
          )
          or
          (
              max(slo:sli_error:ratio_rate30m{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"} > (6 * 0.05)) without (sloth_window)
              and
              max(slo:sli_error:ratio_rate6h{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"} > (6 * 0.05)) without (sloth_window)
          )
        labels:
          category: correctness
          sloth_severity: page
        annotations:
          summary: '{{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget burn
        rate is over expected.'
          title: (page) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
            burn rate is too fast.
      - alert: ChatGPTLogin
        expr: |
          (
              max(slo:sli_error:ratio_rate2h{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"} > (3 * 0.05)) without (sloth_window)
              and
              max(slo:sli_error:ratio_rate1d{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"} > (3 * 0.05)) without (sloth_window)
          )
          or
          (
              max(slo:sli_error:ratio_rate6h{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"} > (1 * 0.05)) without (sloth_window)
              and
              max(slo:sli_error:ratio_rate3d{sloth_id="chatGPT-chatgpt-login", sloth_service="chatGPT", sloth_slo="chatgpt-login"} > (1 * 0.05)) without (sloth_window)
          )
        labels:
          category: correctness
          sloth_severity: ticket
        annotations:
          summary: '{{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget burn
        rate is over expected.'
          title: (ticket) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
            burn rate is too fast.